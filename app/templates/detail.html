{% extends "base.html" %}

{% set page = "detail" %}

{% block body %}
<h1>Detail of Suite "{{ suite.id }}" üëç</h1>

<div id="notice"></div>

<form id="detail">
    <div class="form-group">
        <label for="data">Test Suite (File)</label>
        <textarea name="data" class="form-control">{{ suite.data }}</textarea>
    </div>
</form>

<div class="btn-group" role="group" aria-label="Button group with ...">
    <button type="button" class="btn btn-outline-primary btn-sm"
            form="detail" onclick="save(this.form);">
        Save
    </button>
    <button type="button" form="detail" class="btn btn-outline-success btn-sm">
        Save &amp; Execution
    </button>
    <div id=results class="btn-group" role="group">
        <button class="btn btn-outline-info btn-sm dropdown-toggle" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Results
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            {% for result in results %}
            <a class="dropdown-item" target="_blank"
               href="/{{suite.id}}/result/{{result.id}}">{{result.id}}</a>
            {% endfor %}
        </div>
    </div>
    <!-- Button trigger modal -->
    <button type="button" class="btn btn-outline-danger btn-sm" 
            data-toggle="modal" data-target="#delete-confirm">
        Delete
    </button>
</div>



<!-- Modal -->
<div class="modal fade" id="delete-confirm" tabindex="-1" role="dialog" 
     aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-body">
        Delete the Test Suite?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary btn-sm">Yes, Delete It!</button>
      </div>
    </div>
  </div>
</div>


<script>
var id="{{suite.id}}", rev="{{suite.rev}}";

function notice(msg) {
    document.querySelector('#notice').insertAdjacentHTML('afterbegin', `
        <div class="alert alert-primary alert-dismissible fade show" role="alert">
            ${msg}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        `);
}

function save(form) {
    notice(`Saved. Revision: ${rev}`);
}

function exec() {
    notice(`Executed.`);
}

// ref: https://stackoverflow.com/questions/37629860/automatically-resizing-textarea-in-bootstrap
document.querySelector('textarea').addEventListener('keydown', function() {
    this.style.overflow = 'hidden';
    this.style.paddingBottom = '25px';
    this.style.height = 0;
    this.style.height = this.scrollHeight + 'px';
    }, false);
document.querySelector('textarea').dispatchEvent(new Event('keydown'));
</script>
{% endblock %}
